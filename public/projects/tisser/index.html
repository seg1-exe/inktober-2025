<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Inktober 2025 - Weave</title>
  <style>
    body {
      margin: 0;
      background: radial-gradient(circle at center, #0a0a0a, #000);
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    .spider {
      position: fixed;
      width: clamp(28px, 7vw, 52px);
      height: auto;
      pointer-events: none;
      transform: translate(-50%, -50%);
      will-change: transform, left, top;
    }
    .hint {
      position: fixed; inset: auto 0 10px 0;
      display: flex; justify-content: center;
      font: 500 12px/1 system-ui, sans-serif; opacity: .5;
      pointer-events: none;
    }
    @media (min-width: 768px){
      .hint{ display:none; }
    }
  </style>
</head>
<body>
    <audio loop autoplay><source src="/projects/tisser/bgmusic.mp3"></audio>
    <!-- SVG Araign√©e -->
    <svg xmlns="http://www.w3.org/2000/svg" class="spider" viewBox="0 0 120 120" aria-label="Spider" role="img">
        <defs>
            <!-- L√©g√®re lueur pour bien ressortir sur fond sombre -->
            <filter id="softGlow" x="-50%" y="-50%" width="200%" height="200%">
            <feDropShadow dx="0" dy="0" stdDeviation="1.6" flood-color="#ffffff" flood-opacity="0.28"/>
            </filter>

            <!-- D√©grad√©s pour donner un peu de volume -->
            <linearGradient id="abdomenGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%"  stop-color="#ffffff"/>
            <stop offset="100%" stop-color="#e8e8e8"/>
            </linearGradient>
            <linearGradient id="thoraxGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%"  stop-color="#ffffff"/>
            <stop offset="100%" stop-color="#efefef"/>
            </linearGradient>
        </defs>

        <!-- Groupe principal : tu peux animer ce <g id="spider"> si besoin -->
        <g id="spider" filter="url(#softGlow)" stroke="#f2f2f2" stroke-linecap="round" stroke-linejoin="round">
            <!-- PATTES GAUCHES (4) -->
            <g fill="none" stroke-width="3">
            <path d="M57 60 C 37 50, 28 40, 20 32" />
            <path d="M57 64 C 38 62, 28 56, 16 50" />
            <path d="M57 68 C 38 76, 26 82, 15 88" />
            <path d="M57 72 C 40 90, 30 100, 20 108" />
            </g>

            <!-- PATTES DROITES (4) -->
            <g fill="none" stroke-width="3">
            <path d="M63 60 C 83 50, 92 40, 100 32" />
            <path d="M63 64 C 82 62, 92 56, 104 50" />
            <path d="M63 68 C 82 76, 94 82, 105 88" />
            <path d="M63 72 C 80 90, 90 100, 100 108" />
            </g>

            <!-- CORPS -->
            <!-- Abdomen (arri√®re) -->
            <ellipse cx="60" cy="76" rx="18" ry="22" fill="url(#abdomenGrad)" stroke="#f2f2f2" stroke-width="1.4"/>
            <!-- Thorax/C√©phalothorax (avant) -->
            <ellipse cx="60" cy="56" rx="12" ry="10" fill="url(#thoraxGrad)" stroke="#f2f2f2" stroke-width="1.2"/>

            <!-- P√©dipalpes -->
            <path d="M53 58 Q 49.5 60, 47.5 62" fill="none" stroke="#f2f2f2" stroke-width="2"/>
            <path d="M67 58 Q 70.5 60, 72.5 62" fill="none" stroke="#f2f2f2" stroke-width="2"/>

            <!-- Spinnerets (glandes s√©ricig√®nes) -->
            <path d="M58 96 l -2 6" stroke="#f2f2f2" stroke-width="1.5"/>
            <path d="M62 96 l  2 6" stroke="#f2f2f2" stroke-width="1.5"/>

            <!-- YEUX (8) -->
            <g fill="#ff3b30" stroke="none">
            <!-- rang√©e sup√©rieure -->
            <circle cx="56" cy="53.6" r="1.6"/>
            <circle cx="60" cy="53.2" r="1.9"/>
            <circle cx="64" cy="53.6" r="1.6"/>
            <!-- rang√©e inf√©rieure -->
            <circle cx="55" cy="55.9" r="1.3"/>
            <circle cx="58.4" cy="56.3" r="1.2"/>
            <circle cx="61.6" cy="56.3" r="1.2"/>
            <circle cx="65"  cy="55.9" r="1.3"/>
            <!-- petit ≈ìil central -->
            <circle cx="60" cy="55" r="0.9"/>
            </g>

            <!-- Mini reflet sur l'abdomen (optionnel) -->
            <path d="M52 66 C 50 64, 50 60, 54 58" fill="none" stroke="#ffffff" stroke-opacity="0.45" stroke-width="1.2"/>
        </g>
    </svg>



  <!-- Librairies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.39/Tone.min.js"></script>

  <script>
  let points = [];
  let spider;
  let synth;
  let spiderEl;

  // üéµ Sons
  let moveSound;
  let spiderSounds = [];
  let lastSpiderSoundTime = 0;
  let nextSpiderSoundDelay = 0;

  // Pour limiter la fr√©quence du son de d√©placement
  let lastMoveSoundTime = 0;

  function setup() {
    createCanvas(windowWidth, windowHeight);
    spider = createVector(width/2, height/2);

    synth = new Tone.PolySynth(Tone.Synth).toDestination();
    spiderEl = document.querySelector(".spider");

    // Charger les sons
    moveSound = new Tone.Player("/projects/tisser/move.mp3").toDestination();
    moveSound.autostart = false;

    spiderSounds = [
      new Tone.Player("/projects/tisser/spider1.mp3").toDestination(),
      new Tone.Player("/projects/tisser/spider2.mp3").toDestination(),
      new Tone.Player("/projects/tisser/spider3.mp3").toDestination(),
      new Tone.Player("/projects/tisser/spider4.mp3").toDestination()
    ];

    // Premier d√©lai al√©atoire pour sons d‚Äôaraign√©e
    nextSpiderSoundDelay = random(7000, 10000);
  }

  function draw() {
    background(10, 10, 15, 200);

    // --- Toile ---
    stroke(200, 200, 255, 150);
    strokeWeight(1);
    for (let i = 0; i < points.length; i++) {
      let p1 = points[i];
      if (i > 0) {
        let prev = points[i - 1];
        line(p1.x, p1.y, prev.x, prev.y);
      }
      for (let j = 0; j < i; j++) {
        let p2 = points[j];
        let d = dist(p1.x, p1.y, p2.x, p2.y);
        if (d < 200) {
          let midX = (p1.x + p2.x) / 2;
          let midY = (p1.y + p2.y) / 2;
          let dm = dist(mouseX, mouseY, midX, midY);
          let offset = (dm < 100) ? sin(frameCount * 0.2) * 2 : 0;
          line(p1.x, p1.y, p2.x + offset, p2.y + offset);
        }
      }
    }

    // --- Araign√©e ---
    let target = createVector(mouseX, mouseY);
    let prevPos = spider.copy();
    spider.lerp(target, 0.15);

    // --- Sons d‚Äôaraign√©es al√©atoires ---
    if (millis() - lastSpiderSoundTime > nextSpiderSoundDelay) {
      let s = random(spiderSounds);
      if (s.loaded) {
        s.start();
      }
      lastSpiderSoundTime = millis();
      nextSpiderSoundDelay = random(5000, 8000);
    }

    // --- Position du SVG ---
    spiderEl.style.left = spider.x + "px";
    spiderEl.style.top = spider.y + "px";
  }

  function mousePressed() {
    if (Tone.context.state !== 'running') {
      Tone.start();
    }

    points.push(createVector(spider.x, spider.y));
  }

  function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
  }
</script>


</body>
</html>
